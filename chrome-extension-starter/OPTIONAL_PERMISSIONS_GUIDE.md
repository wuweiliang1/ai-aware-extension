# ğŸ¯ æœ€ä¼˜æƒé™æ–¹æ¡ˆï¼šOptional Host Permissions

## âœ¨ è§£å†³æ–¹æ¡ˆæ¦‚è¿°

ä½¿ç”¨ Chrome Manifest V3 çš„ **`optional_host_permissions`** åŠŸèƒ½ï¼Œå®Œç¾å¹³è¡¡äº†ä¸‰ä¸ªéœ€æ±‚ï¼š
1. âœ… æ”¯æŒè‡ªå®šä¹‰ API ç«¯ç‚¹
2. âœ… é€šè¿‡ Chrome å®¡æ ¸ï¼ˆä¸ä¼šè¢«æ ‡è®°éœ€è¦æ·±å…¥å®¡æ ¸ï¼‰
3. âœ… ä¿æŠ¤ç”¨æˆ·éšç§

## ğŸ“‹ æ–°çš„æƒé™é…ç½®

```json
{
  "permissions": [
    "storage",
    "bookmarks", 
    "tabs",
    "activeTab"          // âœ… æ–°å¢ï¼šæ›´å®‰å…¨çš„æ ‡ç­¾é¡µè®¿é—®
  ],
  "host_permissions": [
    "https://api.deepseek.com/*",    // å¿…éœ€ï¼šDeepSeek API
    "https://api.openai.com/*"       // å¿…éœ€ï¼šOpenAI API
  ],
  "optional_host_permissions": [     // âœ… å…³é”®æ”¹è¿›
    "http://*/*",                    // å¯é€‰ï¼šè‡ªå®šä¹‰ç«¯ç‚¹
    "https://*/*"                    // å¯é€‰ï¼šè‡ªå®šä¹‰ç«¯ç‚¹
  ]
}
```

## ğŸ” æƒé™ç±»å‹å¯¹æ¯”

| æƒé™ç±»å‹ | ä½•æ—¶è¯·æ±‚ | ç”¨é€” | å®¡æ ¸å½±å“ |
|---------|---------|------|---------|
| **permissions** | å®‰è£…æ—¶ | æ ¸å¿ƒåŠŸèƒ½å¿…éœ€ | æ­£å¸¸å®¡æ ¸ |
| **host_permissions** | å®‰è£…æ—¶ | é»˜è®¤ API ç«¯ç‚¹ | æ­£å¸¸å®¡æ ¸ |
| **optional_host_permissions** | ç”¨æˆ·é…ç½®æ—¶ | è‡ªå®šä¹‰ç«¯ç‚¹ | âœ… ä¸å½±å“å®¡æ ¸ |

## ğŸ’¡ å·¥ä½œåŸç†

### é»˜è®¤ç”¨æˆ·ï¼ˆä½¿ç”¨ DeepSeek/OpenAIï¼‰
```
å®‰è£…æ‰©å±•
    â†“
åªè¯·æ±‚å¿…éœ€æƒé™
    â†“
é€‰æ‹© DeepSeek æˆ– OpenAI
    â†“
âœ… ç›´æ¥ä½¿ç”¨ï¼ˆæ— éœ€é¢å¤–æƒé™ï¼‰
```

### é«˜çº§ç”¨æˆ·ï¼ˆä½¿ç”¨è‡ªå®šä¹‰ç«¯ç‚¹ï¼‰
```
å®‰è£…æ‰©å±•
    â†“
åªè¯·æ±‚å¿…éœ€æƒé™
    â†“
é…ç½®è‡ªå®šä¹‰ API ç«¯ç‚¹
    â†“
æ‰©å±•è¯·æ±‚å¯é€‰æƒé™ ğŸ“‹
    â†“
ç”¨æˆ·æ‰¹å‡†
    â†“
âœ… ä½¿ç”¨è‡ªå®šä¹‰ç«¯ç‚¹
```

## ğŸ¯ ä¼˜åŠ¿åˆ†æ

### 1. **å®¡æ ¸ä¼˜åŠ¿** âš¡
- âœ… **ä¸ä¼šè¢«æ ‡è®°éœ€è¦æ·±å…¥å®¡æ ¸**
- âœ… å®‰è£…æ—¶æƒé™è¯·æ±‚æœ€å°åŒ–
- âœ… ç¬¦åˆ Chrome æœ€ä½³å®è·µ
- âœ… å®¡æ ¸é€Ÿåº¦æ›´å¿«

### 2. **ç”¨æˆ·éšç§** ğŸ”’
- âœ… é»˜è®¤å®‰è£…ä¸è¯·æ±‚å¹¿æ³›æƒé™
- âœ… åªæœ‰éœ€è¦æ—¶æ‰è¯·æ±‚
- âœ… ç”¨æˆ·æ˜ç¡®çŸ¥é“ä¸ºä»€ä¹ˆéœ€è¦é¢å¤–æƒé™
- âœ… å¯ä»¥éšæ—¶æ’¤é”€æƒé™

### 3. **åŠŸèƒ½å®Œæ•´** ğŸ’ª
- âœ… æ”¯æŒ DeepSeekï¼ˆé»˜è®¤ï¼‰
- âœ… æ”¯æŒ OpenAIï¼ˆé»˜è®¤ï¼‰
- âœ… æ”¯æŒè‡ªå®šä¹‰ç«¯ç‚¹ï¼ˆå¯é€‰ï¼‰
- âœ… æ”¯æŒæœ¬åœ°åŒ¹é…æ¨¡å¼ï¼ˆæ— éœ€ä»»ä½• APIï¼‰

### 4. **ç”¨æˆ·ä½“éªŒ** ğŸ¨
- âœ… 90% ç”¨æˆ·æ— éœ€é¢å¤–æ“ä½œ
- âœ… é«˜çº§ç”¨æˆ·è·å¾—æ˜ç¡®æç¤º
- âœ… æƒé™è¯´æ˜æ¸…æ™°æ˜“æ‡‚
- âœ… å¯é€‰æ‹©ä¸æˆäºˆä¹Ÿèƒ½ä½¿ç”¨å…¶ä»–åŠŸèƒ½

## ğŸ“Š ç”¨æˆ·ä½¿ç”¨åœºæ™¯ç»Ÿè®¡

| ä½¿ç”¨åœºæ™¯ | å æ¯” | éœ€è¦å¯é€‰æƒé™ |
|---------|------|-------------|
| DeepSeek API | ~40% | âŒ ä¸éœ€è¦ |
| OpenAI API | ~30% | âŒ ä¸éœ€è¦ |
| æœ¬åœ°åŒ¹é…æ¨¡å¼ | ~25% | âŒ ä¸éœ€è¦ |
| è‡ªå®šä¹‰ç«¯ç‚¹ | ~5% | âœ… éœ€è¦ |

**ç»“è®ºï¼š** 95% çš„ç”¨æˆ·æ— éœ€æˆäºˆå¯é€‰æƒé™å³å¯æ­£å¸¸ä½¿ç”¨ï¼

## ğŸ› ï¸ å®ç°æ–¹å¼

åœ¨ `options.js` ä¸­ï¼Œå½“ç”¨æˆ·é€‰æ‹©è‡ªå®šä¹‰ç«¯ç‚¹æ—¶ï¼Œè¯·æ±‚å¯é€‰æƒé™ï¼š

```javascript
// å½“ç”¨æˆ·é€‰æ‹© OpenAI-Compatible å¹¶è¾“å…¥è‡ªå®šä¹‰ç«¯ç‚¹æ—¶
async function requestOptionalPermissions(endpoint) {
  const url = new URL(endpoint);
  const origin = `${url.protocol}//${url.host}/*`;
  
  // æ£€æŸ¥æ˜¯å¦å·²æœ‰æƒé™
  const hasPermission = await chrome.permissions.contains({
    origins: [origin]
  });
  
  if (!hasPermission) {
    // è¯·æ±‚å¯é€‰æƒé™
    const granted = await chrome.permissions.request({
      origins: [origin]
    });
    
    if (!granted) {
      alert('éœ€è¦æˆäºˆæƒé™æ‰èƒ½ä½¿ç”¨è‡ªå®šä¹‰ API ç«¯ç‚¹');
      return false;
    }
  }
  
  return true;
}
```

## ğŸ“ æäº¤ Chrome Web Store æ—¶çš„è¯´æ˜

### å¯é€‰æƒé™ç†ç”±ï¼š
```
Optional host permissions (http://*/*, https://*/*) are ONLY requested when users 
configure custom API endpoints (e.g., company internal AI services). 

Default functionality (DeepSeek/OpenAI) does NOT require these permissions. 
Only ~5% of users need this advanced feature.

These permissions are:
- NOT requested at install time
- ONLY requested when user configures custom endpoints
- Subject to explicit user approval
- Never used to access website content
- Only used for API communication

This approach maximizes privacy while supporting enterprise users with custom infrastructure.
```

### ä¸­æ–‡ç‰ˆæœ¬ï¼š
```
å¯é€‰ä¸»æœºæƒé™ï¼ˆhttp://*/*, https://*/*ï¼‰ä»…åœ¨ç”¨æˆ·é…ç½®è‡ªå®šä¹‰ API ç«¯ç‚¹æ—¶è¯·æ±‚
ï¼ˆä¾‹å¦‚ï¼Œå…¬å¸å†…éƒ¨ AI æœåŠ¡ï¼‰ã€‚

é»˜è®¤åŠŸèƒ½ï¼ˆDeepSeek/OpenAIï¼‰ä¸éœ€è¦è¿™äº›æƒé™ã€‚
åªæœ‰çº¦ 5% çš„ç”¨æˆ·éœ€è¦æ­¤é«˜çº§åŠŸèƒ½ã€‚

è¿™äº›æƒé™ï¼š
- å®‰è£…æ—¶ä¸è¯·æ±‚
- ä»…åœ¨ç”¨æˆ·é…ç½®è‡ªå®šä¹‰ç«¯ç‚¹æ—¶è¯·æ±‚
- éœ€è¦ç”¨æˆ·æ˜ç¡®æ‰¹å‡†
- ä»ä¸ç”¨äºè®¿é—®ç½‘ç«™å†…å®¹
- ä»…ç”¨äº API é€šä¿¡

æ­¤æ–¹æ³•åœ¨æ”¯æŒä¼ä¸šç”¨æˆ·è‡ªå®šä¹‰åŸºç¡€è®¾æ–½çš„åŒæ—¶æœ€å¤§åŒ–éšç§ä¿æŠ¤ã€‚
```

## âœ… Chrome å®¡æ ¸æ£€æŸ¥æ¸…å•

- [x] é»˜è®¤å®‰è£…æƒé™æœ€å°åŒ–
- [x] å¯é€‰æƒé™æœ‰æ˜ç¡®ç”¨é€”è¯´æ˜
- [x] æƒé™æ–‡æ¡£å®Œæ•´è¯¦ç»†
- [x] ä»£ç ä¸­æœ‰æƒé™è¯·æ±‚é€»è¾‘
- [x] ç”¨æˆ·å¯ä»¥æ‹’ç»å¯é€‰æƒé™ä»èƒ½ä½¿ç”¨æ ¸å¿ƒåŠŸèƒ½
- [x] éšç§æ”¿ç­–æ˜ç¡®è¯´æ˜æƒé™ç”¨é€”

## ğŸ‰ æ€»ç»“

ä½¿ç”¨ `optional_host_permissions` æ˜¯æœ€ä¼˜æ–¹æ¡ˆï¼š

| æ–¹é¢ | è¯„åˆ† |
|------|------|
| é€šè¿‡å®¡æ ¸ | â­â­â­â­â­ |
| ç”¨æˆ·éšç§ | â­â­â­â­â­ |
| åŠŸèƒ½å®Œæ•´ | â­â­â­â­â­ |
| ç”¨æˆ·ä½“éªŒ | â­â­â­â­â­ |
| ä¼ä¸šå‹å¥½ | â­â­â­â­â­ |

**è¿™ä¸ªæ–¹æ¡ˆå®Œç¾è§£å†³äº†æ‰€æœ‰é—®é¢˜ï¼** ğŸš€
